(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{357:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("img",{attrs:{src:"/images/2020/02/10/2.jpeg",alt:"",width:"1200",height:"578",loading:"lazy"}})]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#为什么要做第三方客户端"}},[t._v("为什么要做第三方客户端")])]),s("li",[s("a",{attrs:{href:"#从哪些方面优化第三方客户端体验"}},[t._v("从哪些方面优化第三方客户端体验")])]),s("li",[s("a",{attrs:{href:"#用-electron-实现第三方网页客户端"}},[t._v("用 Electron 实现第三方网页客户端")]),s("ul",[s("li",[s("a",{attrs:{href:"#首先要创建一个隐藏的网页"}},[t._v("首先要创建一个隐藏的网页")])]),s("li",[s("a",{attrs:{href:"#抓取隐藏网页中的接口"}},[t._v("抓取隐藏网页中的接口")])]),s("li",[s("a",{attrs:{href:"#抓取隐藏网页中的-html-内容"}},[t._v("抓取隐藏网页中的 html 内容")])])])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"为什么要做第三方客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要做第三方客户端"}},[t._v("#")]),t._v(" 为什么要做第三方客户端")]),t._v(" "),s("ul",[s("li",[t._v("首先是为了获得更好的用户体验。如下图所示，左侧是第三方微博客户端 "),s("em",[t._v("Share")]),t._v("，右侧是 "),s("em",[t._v("V2EX")]),t._v(" 第三方客户端。两者的特点都是界面都很简洁，功能比较纯粹。早期也有很多第三方贴吧 APP、视频软件 APP，但是随着大厂流量战争越打越强，就对这些第三方 APP 进行了封杀。")]),t._v(" "),s("li",[t._v("其次我们可以在第三方客户端中加入广告和捐赠功能，来获得一部分额外收入。🍭")]),t._v(" "),s("li",[t._v("最后就是在有一定用户量后开源出来可以吸一波 Star。不过这个和上面有点矛盾，因为开源出来后你加入的广告就可能被别人去掉后重新编译打包了。甚至里面的捐赠支付二维码会被改成其他人的二维码。这一点就看个人取舍了。")])]),t._v(" "),s("StyledImg",{staticStyle:{width:"80%"},attrs:{src:"/images/2020/02/12/1.png",shadow:"",center:""}}),t._v(" "),s("h2",{attrs:{id:"从哪些方面优化第三方客户端体验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从哪些方面优化第三方客户端体验"}},[t._v("#")]),t._v(" 从哪些方面优化第三方客户端体验")]),t._v(" "),s("ol",[s("li",[t._v("使客户端功能更纯粹。现在无论什么 APP 都要加新闻、直播、钱包、小视频的功能（说的就是微信、百度、微博这些毒瘤 😡）。我们封装第三方客户端时首当其冲就是要去掉这些无用功能。")]),t._v(" "),s("li",[t._v("去除广告。幸运破解器也可以帮助去除，不过成功率较低。")]),t._v(" "),s("li",[t._v("使用贴合原生系统的设计风格。安卓使用 material design，苹果使用 cupertino 设计风格（这个名子来自 flutter，官方没有具体名子）。")]),t._v(" "),s("li",[t._v("动画贴近原生。使用系统级的过渡动画，这样会使 APP 界面切换更流畅。如何检测动画是否是系统级的？在开发者选项中将动画速度切换成 0.5 倍，如果 APP 的动画速度也变慢了，说明动画是系统级的。在 flutter 中，由于控件都是使用 Skia 绘制的，而非原生控件，动画引擎也是内建的，所以无法使用系统内建动画，跟系统有一股割裂感。这也是我不喜欢 flutter 的一点。")]),t._v(" "),s("li",[t._v("增加特色功能。如主题换肤、特殊权限破解（如看视频免 vip 等等，但是随着这些鉴权逐渐迁往服务端，现在基本不可能实现了，只能想办法找一些漏洞）。")])]),t._v(" "),s("h2",{attrs:{id:"用-electron-实现第三方网页客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用-electron-实现第三方网页客户端"}},[t._v("#")]),t._v(" 用 Electron 实现第三方网页客户端")]),t._v(" "),s("p",[t._v("Electron 本身便是一个浏览器，在实现第三方网页客户端上有天然优势。传统方法抓取网页 api 的方式是尽可能的模拟请求头，但是在 electron 中我们可以用 webview 访问这个网页，然后将 webview 中的请求到的接口抓取过来。这样本质和直接访问原网页没有任何不同，但是我们可以在抓到接口后对页面进行自定义，添加更多自定义功能。")]),t._v(" "),s("h3",{attrs:{id:"首先要创建一个隐藏的网页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#首先要创建一个隐藏的网页"}},[t._v("#")]),t._v(" 首先要创建一个隐藏的网页")]),t._v(" "),s("p",[t._v("electron 里面据我所知的有两种方法。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("通过 "),s("code",[t._v("BrowserWindow")]),t._v(" 主进程中创建"),s("br"),t._v("\n设置 "),s("code",[t._v("BrowserWindow")]),t._v(" 的 show 属性为 "),s("code",[t._v("false")]),t._v("，此时 window 示例在主进程中，渲染进程想要获取数据需要通过 ipc 和主进程通信。这样做的的好处是在主进程中能更方便的进行更高权限的操作。")])]),t._v(" "),s("li",[s("p",[t._v("在渲染进程中直接通过 "),s("code",[t._v("webview")]),t._v(" 创建"),s("br"),t._v("\n创建一个隐藏的 "),s("code",[t._v("webview")]),t._v(" 去访问相关网页地址。好处非常明显，获取数据不用和主进程通信，操作基本在渲染进程完成。")])])]),t._v(" "),s("h3",{attrs:{id:"抓取隐藏网页中的接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抓取隐藏网页中的接口"}},[t._v("#")]),t._v(" 抓取隐藏网页中的接口")]),t._v(" "),s("p",[t._v("使用 debgguer 工具获取网页中请求的接口。这个 degguer 和 chrome 中的非常相似，不过是没有界面的。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" BrowserWindow "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'electron'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" win "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BrowserWindow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("show")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  win"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("debugger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("attach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Debugger attach failed : '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nwin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("debugger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'detach'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reason")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Debugger detached due to : '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nwin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("debugger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Network.requestWillBeSent'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://www.github.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      win"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("debugger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("detach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nwin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("debugger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendCommand")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Network.enable'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("只有运行 attach 方法后，接口才会被捕捉到，类似 chrome 中不开启开发者工具就不会捕捉请求。抓取到想要的数据后需要运行 detach 方法，不然内存会爆表。")]),t._v(" "),s("h3",{attrs:{id:"抓取隐藏网页中的-html-内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抓取隐藏网页中的-html-内容"}},[t._v("#")]),t._v(" 抓取隐藏网页中的 html 内容")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("executeJavaScript")]),t._v(" 方法获取 dom 元素，在页面加载完成后执行。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("win"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'did-finish-load'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'document.getElementById(\"username\").innerHTML'")]),t._v("\n  win"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webContents\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeJavaScript")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("username")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("有以上两个方法肯定能够很轻松的制作出网页第三方客户端，如果有时间和精力的话 🤟")])],1)}),[],!1,null,null,null);s.default=e.exports}}]);